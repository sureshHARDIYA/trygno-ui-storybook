import{r as p,c as h,g as b,h as n,H as u}from"./iframe-CAlIYAxv.js";import"./preload-helper-D9Z9MdNV.js";const m=':host{--tui-dropdown-menubox-background:var(--color-white);--tui-dropdown-menubox-max-height:400px;--tui-dropdown-option-hover-color:var(--color-sand-200);--tui-label-margin:0;--tui-dropdown-background-color:transparent;font-size:var(--font-size-regular)}:host fieldset{border:0;margin:0;padding:0}:host fieldset legend.combo-label{display:flex;width:100%;margin:var(--tui-label-margin);font-weight:var(--font-weight-demibold)}:host .select__control{align-items:center;cursor:default;display:flex;flex-wrap:wrap;justify-content:space-between;min-height:38px;position:relative;transition:100ms;background-color:var(--tui-dropdown-background-color);border:2px solid var(--color-black-light);border-radius:var(--space-tiny);box-sizing:border-box;outline:0px !important}:host .select__control:hover{box-shadow:0 0 0 0.5rem var(--color-sand)}:host .select__control:active{box-shadow:0 0 0 0.5rem var(--color-sand-dark)}:host .select__control:focus{outline:none;box-shadow:0 0 0 2px var(--color-white), 0 0 0 4px var(--color-secondary-outline)}:host .select__control .select__value_container{align-items:center;display:grid;flex:1 1 0%;flex-wrap:wrap;position:relative;overflow:hidden;padding:var(--space-medium);box-sizing:border-box}:host .select__control .select__indicators{align-items:center;align-self:stretch;display:flex;flex-shrink:0;box-sizing:border-box}:host .select__control .select__indicators .indicator-icon{display:inline-block;fill:currentcolor;line-height:1;stroke:currentcolor;stroke-width:0}:host .select__control .select__indicators .select__indicator{display:flex;transition:color 150ms;color:var(--color-black-light);padding:8px;box-sizing:border-box}:host .select__control .select__indicators .select_clear_indicator{display:flex;transition:color 150ms;color:var(--color-black-light);padding:8px;box-sizing:border-box}:host .select__control .select__indicators .select__indicator-separator{align-self:stretch;width:1px;background-color:var(--color-black-light);margin-bottom:8px;margin-top:8px;box-sizing:border-box}:host .select__control .select__indicators .select__dropdown-indicator{display:flex;transition:color 150ms;color:var(--color-black-light);padding:8px;box-sizing:border-box}:host .combo *,:host .combo *::before,:host .combo *::after{box-sizing:border-box}:host .combo{display:block;margin-bottom:var(--space-large);position:relative}:host .open .combo-input{border-radius:4px 4px 0 0}:host .combo-menu{border:2px solid var(--color-black-light);border-radius:0 0 var(--space-tiny) var(--space-tiny);display:none;max-height:var(--tui-dropdown-menubox-max-height);overflow-y:auto;left:0;position:absolute;top:100%;width:100%;z-index:99999;background:var(--tui-dropdown-menubox-background);touch-action:pan-y;overscroll-behavior:contain;-webkit-overflow-scrolling:touch}:host .combo-menu{display:none}:host .combo-menu.visible{display:block}:host .open .combo-menu{display:block}:host .combo-option{padding:var(--space-medium)}:host .combo-option:hover{background:var(--tui-dropdown-option-hover-color)}:host .combo-option.option-current{outline:3px solid var(--color-secondary-gray);outline-offset:-3px}:host .combo-option[aria-selected=true]{padding-right:1.875rem;position:relative}:host .combo-option[aria-selected=true]::after{border-bottom:2px solid var(--color-black);border-right:2px solid var(--color-black);content:"";height:var(--space-medium);position:absolute;right:15px;top:50%;transform:translate(0, -50%) rotate(45deg);width:8px}:host trygno-alert trygno-icon{--icon-stroke:var(--color-primary)}',s={Close:0,CloseSelect:1,First:2,Last:3,Next:4,Open:5,PageDown:6,PageUp:7,Previous:8,Type:10},l=class{constructor(e){p(this,e),this.dropdownExpanded=h(this,"dropdownExpanded",7),this.dropdownCollapsed=h(this,"dropdownCollapsed",7),this.optionSelected=h(this,"optionSelected",7)}get el(){return b(this)}comboEl;labelEl;listboxEl;comboElPlaceholder;wrapperElement;options;componentId="combo";selectedItem;error;placeholder="Select an option";label;required=!1;isClearable=!1;dataCy;parsedOptions;startX=0;ignoreBlur=!1;activeIndex=0;open=!1;searchString="";searchTimeout=null;hasLabelSlot=!1;hasHelpTextSlot=!1;labelId="combobox-select-label-id";dropdownExpanded;dropdownCollapsed;optionSelected;parsePropsOptions(e){e?this.parsedOptions=l.parseJSONFromString(e):this.parsedOptions=null}static parseJSONFromString=e=>{if(typeof e=="object")return e;if(typeof e=="string")try{return JSON.parse(e)}catch(o){return console.warn("Invalid JSON string:",o),null}return null};componentWillLoad(){this.parsePropsOptions(this.options);const e=this.el.querySelector('[slot="label"]');this.hasLabelSlot=!!e;const o=this.el.querySelector('[slot="help-text"]');this.hasHelpTextSlot=!!o,this.hasLabelSlot&&e&&(this.labelId=e.id??"combobox-select-label-id"),this.selectedItem?this.initializeSelectedItem():this.activeIndex=-1,this.label&&this.hasLabelSlot&&console.warn("It seems you have provided both Label and label slot. Label prop will be ignored.")}componentDidLoad(){this.comboEl=this.el.shadowRoot.querySelector(".select__control"),this.listboxEl=this.el.shadowRoot.querySelector(".combobox__list"),this.wrapperElement=this.el.shadowRoot.querySelector(".dropdown-wrapper"),this.comboElPlaceholder=this.el.shadowRoot.querySelector(".combobox-placeholder");const e=this.el.shadowRoot.querySelector('slot[name="label"]');if(e){const o=e.assignedElements();if(o.length>0){const t=o[0];t.id&&(this.labelId=t.id),t.addEventListener("click",this.onLabelClick)}}this.listboxEl&&(this.listboxEl.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),this.listboxEl.addEventListener("touchend",this.handleTouchEnd)),this.activeIndex>=0&&this.selectOption(this.activeIndex)}handleTouchStart=e=>{e.touches.length===1&&(this.ignoreBlur=!0,this.startX=e.touches[0].clientX)};handleTouchEnd=e=>{this.ignoreBlur=!1;const t=e.changedTouches[0].clientX-this.startX,i=Array.from(this.listboxEl.children);if(i.length!==0&&Math.abs(t)>30){let r=this.activeIndex;t>0?r=Math.min(this.activeIndex+1,i.length-1):r=Math.max(this.activeIndex-1,0),r!==this.activeIndex&&(this.onOptionChange(r),this.selectOption(r),this.optionSelected.emit({key:this.componentId,value:this.parsedOptions[r].value}))}};disconnectedCallback(){const e=this.el.shadowRoot.querySelector('slot[name="label"]');if(e){const o=e.assignedElements();o.length>0&&o[0].removeEventListener("click",this.onLabelClick)}}initializeSelectedItem(){const e=this.parsedOptions.findIndex(o=>o.value===this.selectedItem);e>=0&&(this.activeIndex=e)}mouseClickButton=e=>{this.updateMenuState(!this.open,!1),this.open?this.dropdownExpanded.emit(e):this.dropdownCollapsed.emit(e)};onComboKeyDown=e=>{const{key:o}=e,t=this.parsedOptions.length-1,i=l.getActionFromKey(e,this.open);switch(i){case s.Last:case s.First:this.updateMenuState(!0);case s.Next:case s.Previous:case s.PageUp:case s.PageDown:return e.preventDefault(),this.onOptionChange(l.getUpdatedIndex(this.activeIndex,t,i));case s.CloseSelect:e.preventDefault(),this.selectOption(this.activeIndex),this.optionSelected.emit({key:this.componentId,value:this.parsedOptions[this.activeIndex].value});case s.Close:return e.preventDefault(),this.dropdownCollapsed.emit(e),this.updateMenuState(!1);case s.Type:return this.onComboType(o);case s.Open:return e.preventDefault(),this.dropdownExpanded.emit(e),this.updateMenuState(!0);default:return null}};onComboBlur=e=>{this.listboxEl.contains(e.relatedTarget)||this.open&&(this.selectOption(this.activeIndex),this.updateMenuState(!1,!1))};onComboType=e=>{this.updateMenuState(!0);const o=this.getSearchString(e),t=l.getIndexByLetter(this.parsedOptions,o,this.activeIndex+1);t>=0?this.onOptionChange(t):(window.clearTimeout(this.searchTimeout),this.searchString="")};getSearchString=e=>(typeof this.searchTimeout=="number"&&window.clearTimeout(this.searchTimeout),this.searchTimeout=window.setTimeout(()=>{this.searchString=""},500),this.searchString+=e,this.searchString);static getIndexByLetter=(e,o,t=0)=>{const i=[...e.slice(t),...e.slice(0,t)],r=l.filterOptions(i,o)[0],a=c=>c.every(d=>d===c[0]);if(r)return e.indexOf(r);if(a(o.split(""))){const c=l.filterOptions(i,o[0]);return e.indexOf(c[0])}return-1};selectOption=e=>{if(this.activeIndex=e,e>=0){const i=this.parsedOptions[e],r=typeof i=="object"?i.label:i;this.comboEl&&this.comboElPlaceholder&&(this.comboElPlaceholder.innerText=r)}else this.comboEl&&this.comboElPlaceholder&&(this.comboElPlaceholder.innerText=this.placeholder);const o=this.el.shadowRoot.querySelectorAll("[role=option]");Array.from(o).forEach(i=>{i.setAttribute("aria-selected","false"),i.classList.remove("option-current")});const t=o[e];t&&(t.setAttribute("aria-selected","true"),t.classList.add("option-current"))};onOptionChange=e=>{this.activeIndex=e,this.comboEl.setAttribute("aria-activedescendant",`${this.componentId}-${this.activeIndex}`);const o=this.el.shadowRoot.querySelectorAll("[role=option]");Array.from(o).forEach(i=>{i.classList.remove("option-current")});const t=o[e];t&&t.classList.add("option-current"),l.isScrollable(this.listboxEl)&&l.maintainScrollVisibility(o[e],this.listboxEl),l.isElementInView(o[e])||o[e].scrollIntoView({behavior:"smooth",block:"nearest"})};handleOptionclick=e=>{e.stopPropagation();const o=e.target.textContent,t=this.parsedOptions.findIndex(r=>r.label===e.target.textContent),i=this.parsedOptions.find(r=>r.label===o);this.onOptionClick(t),this.selectedItem=i.value.toString(),this.optionSelected.emit({key:this.componentId,value:i.value})};onOptionMouseDown=()=>{this.ignoreBlur=!0};onOptionClick=e=>{this.onOptionChange(e),this.selectOption(e),this.updateMenuState(!1)};static filterOptions=(e=[],o,t=[])=>e.filter(i=>{const r=typeof i=="object"?i.label:i;return r.toLowerCase().indexOf(o.toLowerCase())===0&&t.indexOf(r)<0});static getUpdatedIndex(e,o,t){switch(t){case s.First:return 0;case s.Last:return o;case s.Previous:return Math.max(0,e-1);case s.Next:return Math.min(o,e+1);case s.PageUp:return Math.max(0,e-10);case s.PageDown:return Math.min(o,e+10);default:return e}}static getActionFromKey=(e,o)=>{const{key:t,altKey:i,ctrlKey:r,metaKey:a}=e;if(!o&&["ArrowDown","ArrowUp","Enter"," "].includes(t))return s.Open;if(t==="Home")return s.First;if(t==="End")return s.Last;if(t==="Backspace"||t==="Clear"||t.length===1&&t!==" "&&!i&&!r&&!a)return s.Type;if(o){if(t==="ArrowUp"&&i)return s.CloseSelect;if(t==="ArrowDown"&&!i)return s.Next;if(t==="ArrowUp")return s.Previous;if(t==="PageUp")return s.PageUp;if(t==="PageDown")return s.PageDown;if(t==="Escape")return s.Close;if(t==="Enter"||t===" ")return s.CloseSelect}return null};onLabelClick=()=>{this.comboEl.focus()};updateMenuState=(e,o=!0)=>{if(this.open===e)return;this.open=e,this.comboEl.setAttribute("aria-expanded",`${e}`),e?this.el.classList.add("open"):this.el.classList.remove("open");const t=e?`${this.componentId}-${this.activeIndex}`:"";this.comboEl.setAttribute("aria-activedescendant",t),t===""&&!l.isElementInView(this.comboEl)&&this.comboEl.scrollIntoView({behavior:"smooth",block:"nearest"}),o&&this.comboEl.focus()};static isElementInView(e){const o=e.getBoundingClientRect();return o.top>=0&&o.left>=0&&o.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&o.right<=(window.innerWidth||document.documentElement.clientWidth)}static isScrollable(e){return e&&e.clientHeight<e.scrollHeight}static maintainScrollVisibility(e,o){const{offsetHeight:t,offsetTop:i}=e,{offsetHeight:r,scrollTop:a}=o,c=i<a,d=i+t>a+r;c?o.scrollTo(0,i):d&&o.scrollTo(0,i-r+t)}async openComboBox(){this.updateMenuState(!0,!0)}async closeComboBox(){this.updateMenuState(!1,!1)}renderLabel(){return this.hasLabelSlot?n("slot",{name:"label"}):n("legend",{id:this.labelId,class:"combo-label",onClick:this.onLabelClick,part:"dropdownLabel"},this.label)}renderHelpText(){return this.hasHelpTextSlot?n("slot",{name:"help-text"}):null}render(){let e;return this.selectedItem?e=this.selectedItem:this.placeholder?e=this.placeholder:e="Select and option",n(u,{key:"950190269a7ee4fc39dd25086404acc6fbdb7a22"},n("fieldset",{key:"2815bd939ec70e1c3378680995306212cab88cc6",class:"combo js-select dropdown-wrapper","data-cy":this.dataCy,part:"dropdownFieldSet"},this.renderLabel(),n("slot",{key:"3014a657a8697b4277e80293154a0bbbee203f3d",name:"error"}),this.renderHelpText(),n("div",{key:"213e6e7f8ecfc058b2eb374e1144735275cf957a",class:"select__control combo-input","aria-controls":"listbox1","aria-expanded":this.open?"true":"false","aria-haspopup":"listbox","aria-labelledby":this.labelId,"aria-required":this.required?"true":"false","aria-invalid":this.error?"true":"false",id:this.componentId,role:"combobox",tabindex:"0",onClick:this.mouseClickButton,onKeyDown:this.onComboKeyDown,onBlur:this.onComboBlur,part:"dropdownSelectInput"},n("div",{key:"fdc9e4d02492d2206a1547cd677e58435fd2ab54",class:"combobox select__value_container combobox-placeholder"},e),n("div",{key:"b011024356b420056846043ec1b3ae28ee2f0e50",class:"select__indicators"},n("div",{key:"f8aac670d357611ad5a2ba9562585fe0f6629a5d",class:"select__indicator select__dropdown-indicator","aria-hidden":"true"},n("trygno-icon",{key:"b7782b377f717c068027ca195972d861e32fb22f",name:"chevron-down"})))),n("div",{key:"051795a9fff859576fcd2790338da3cdb8752607",class:`combo-menu combobox__list ${this.open?"visible":"hidden"}`,role:"listbox",id:"listbox1","aria-labelledby":this.labelId,tabindex:"-1",onFocusout:this.onComboBlur},this.parsedOptions.map((o,t)=>n("div",{class:`combo-option combobox__list-item ${t===this.activeIndex&&this.activeIndex!==-1?"option-current":""}`,role:"option","aria-selected":t===this.activeIndex&&this.activeIndex!==-1?"true":"false",tabindex:t===this.activeIndex?"0":"-1",id:`${this.componentId}-${t}`,onClick:this.handleOptionclick,onMouseDown:this.onOptionMouseDown,key:`option-${t}`},o.label)))),this.error&&n("trygno-alert",{key:"13600dc26cb5726ca3f7738719b906fc07c098c7",variant:"danger","data-cy":`
            ${this.componentId}-error-alert
            `},n("trygno-icon",{key:"56f3fb781e5cbe04842fee0eba8a6716f5de14bb",name:"alert-circle",slot:"icon-left"}),this.error))}static get delegatesFocus(){return!0}static get watchers(){return{options:["parsePropsOptions"]}}};l.style=m;export{l as trygno_dropdown};
